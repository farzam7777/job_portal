!function(e,t,n){"use strict";var o={html:'<!DOCTYPE html><html><head><style>.ie * {min-height: auto !important}</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true" {spellcheck}></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" value="http://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" value="http://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" value="http://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{id}?wmode=opaque" data-youtube-id="{id}" frameborder="0" allowfullscreen></iframe>'},i=function(t,n,i){var r=o[t];return e.each(n,function(e,t){r=r.replace(new RegExp("\\{"+e+"\\}","g"),t)}),i&&(r=e(r)),r};e.sceditor=function(o,r){var s,a,l,c,d,u,p,f,h,m,g,b,v,y,x,w,C,k,S,E,T,B,D,M,H,R,N,I,z,O,P,A,L,_,W,F,q,j,V,Q,$,U,Y,K,X,G,J,Z,ee,te,ne,oe,ie,re,se,ae,le,ce=e.sceditor.ie,de=ce&&11>ce,ue=this,pe=o.get?o.get(0):o,fe=e(pe),he=[],me=[],ge=[],be=[],ve={},ye=[];ue.commands=e.extend(!0,{},r.commands||e.sceditor.commands),ue.opts=r=e.extend({},e.sceditor.defaultOptions,r),T=function(){fe.data("sceditor",ue),e.each(r,function(t,n){e.isPlainObject(n)&&(r[t]=e.extend(!0,{},n))}),r.locale&&"en"!==r.locale&&N(),s=e('<div class="sceditor-container" />').insertAfter(fe).css("z-index",r.zIndex),ce&&s.addClass("ie ie"+ce),S=!!fe.attr("required"),fe.removeAttr("required"),R(),L(),I(),H(),P(),z(),O(),e.sceditor.isWysiwygSupported||ue.toggleSourceMode(),G();var o=function(){e(t).unbind("load",o),r.autofocus&&ne(),r.autoExpand&&ue.expandToContent(),K(),y.call("ready")};e(t).load(o),n.readyState&&"complete"===n.readyState&&o()},R=function(){var t=r.plugins;t=t?t.toString().split(","):[],y=new e.sceditor.PluginManager(ue),e.each(t,function(t,n){y.register(e.trim(n))})},N=function(){var t;g=e.sceditor.locale[r.locale],g||(t=r.locale.split("-"),g=e.sceditor.locale[t[0]]),g&&g.dateFormat&&(r.dateFormat=g.dateFormat)},H=function(){var n,o;p=e("<textarea></textarea>").hide(),l=e('<iframe frameborder="0"></iframe>'),r.spellcheck||p.attr("spellcheck","false"),"https:"===t.location.protocol&&l.attr("src","javascript:false"),s.append(l).append(p),c=l[0],f=p[0],ue.dimensions(r.width||fe.width(),r.height||fe.height()),n=_(),n.open(),n.write(i("html",{spellcheck:r.spellcheck?"":'spellcheck="false"',charset:r.charset,style:r.style})),n.close(),u=e(n),d=e(n.body),ue.readOnly(!!r.readOnly),ce&&u.find("html").addClass("ie ie"+ce),(e.sceditor.ios||ce)&&(d.height("100%"),ce||d.bind("touchend",ue.focus)),b=new e.sceditor.rangeHelper(c.contentWindow),ue.val(fe.hide().val()),o=fe.attr("tabindex"),p.attr("tabindex",o),l.attr("tabindex",o)},z=function(){r.autoUpdate&&(d.bind("blur",ue.updateOriginal),p.bind("blur",ue.updateOriginal)),null===r.rtl&&(r.rtl="rtl"===p.css("direction")),ue.rtl(!!r.rtl),r.autoExpand&&u.bind("keyup",ue.expandToContent),r.resizeEnabled&&A(),s.attr("id",r.id),ue.emoticons(r.emoticonsEnabled)},O=function(){e(n).click(Y),e(pe.form).bind("reset",Q).submit(ue.updateOriginal),e(t).bind("resize orientationChanged",K),d.keypress(V).keydown(q).keydown(j).keyup(Z).bind("blur",ae).keyup(le).bind("paste",W).bind(ce?"selectionchange":"keyup focus blur contextmenu mouseup touchend click",ee).bind("keydown keyup keypress focus blur contextmenu",U),r.emoticonsCompat&&t.getSelection&&d.keyup(ie),p.bind("blur",ae).keyup(le).bind("keydown keyup keypress focus blur contextmenu",U).keydown(q),u.mousedown($).bind("blur",ae).bind(ce?"selectionchange":"focus blur contextmenu mouseup click",ee).bind("beforedeactivate keyup",M).keyup(Z).focus(function(){m=null}),s.bind("selectionchanged",te).bind("selectionchanged",G).bind("selectionchanged valuechanged nodechanged",U)},I=function(){var t,n,o,l=ue.commands,c=(r.toolbarExclude||"").split(","),d=r.toolbar.split("|");a=e('<div class="sceditor-toolbar" unselectable="on" />'),e.each(d,function(r,s){t=e('<div class="sceditor-group" />'),e.each(s.split(","),function(r,s){!l[s]||e.inArray(s,c)>-1||(o=l[s].shortcut?" ("+l[s].shortcut+")":"",n=i("toolbarButton",{name:s,dispName:ue._(l[s].tooltip||s)+o},!0),n.data("sceditor-txtmode",!!l[s].txtExec),n.data("sceditor-wysiwygmode",!!l[s].exec),n.click(function(){var t=e(this);return t.hasClass("disabled")||D(t,l[s]),G(),!1}),l[s].tooltip&&n.attr("title",ue._(l[s].tooltip)),l[s].exec||n.addClass("disabled"),l[s].shortcut&&(ue.addShortcut(l[s].shortcut,s),n.attr("title",n.attr("title")+o)),t.append(n))}),t[0].firstChild&&a.append(t)}),e(r.toolbarContainer||s).append(a)},P=function(){e.each(ue.commands,function(t,n){n.keyPress&&he.push(n.keyPress),n.forceNewLineAfter&&e.isArray(n.forceNewLineAfter)&&(ge=e.merge(ge,n.forceNewLineAfter)),n.state?be.push({name:t,state:n.state}):"string"==typeof n.exec&&be.push({name:t,state:n.exec})}),Z()},A=function(){var o,i,a,l,c,d,u=e('<div class="sceditor-grip" />'),p=e('<div class="sceditor-resize-cover" />'),f=0,h=0,m=0,g=0,b=s.width(),v=s.height(),y=!1,x=ue.rtl();o=r.resizeMinHeight||v/1.5,i=r.resizeMaxHeight||2.5*v,a=r.resizeMinWidth||b/1.25,l=r.resizeMaxWidth||1.25*b,c=function(e){"touchmove"===e.type&&(e=t.event);var n=g+(e.pageY-h),c=x?m-(e.pageX-f):m+(e.pageX-f);l>0&&c>l&&(c=l),i>0&&n>i&&(n=i),(!r.resizeWidth||a>c||l>0&&c>l)&&(c=!1),(!r.resizeHeight||o>n||i>0&&n>i)&&(n=!1),(c||n)&&(ue.dimensions(c,n),7>ce&&s.height(n)),e.preventDefault()},d=function(t){y&&(y=!1,p.hide(),s.removeClass("resizing").height("auto"),e(n).unbind("touchmove mousemove",c),e(n).unbind("touchend mouseup",d),t.preventDefault())},s.append(u),s.append(p.hide()),u.bind("touchstart mousedown",function(o){"touchstart"===o.type&&(o=t.event),f=o.pageX,h=o.pageY,m=s.width(),g=s.height(),y=!0,s.addClass("resizing"),p.show(),e(n).bind("touchmove mousemove",c),e(n).bind("touchend mouseup",d),7>ce&&s.height(g),o.preventDefault()})},L=function(){var t,o=r.emoticons,i=r.emoticonsRoot;e.isPlainObject(o)&&r.emoticonsEnabled&&e.each(o,function(r,s){e.each(s,function(e,s){i&&(s={url:i+(s.url||s),tooltip:s.tooltip||e},o[r][e]=s),t=n.createElement("img"),t.src=s.url||s,me.push(t)})})},ne=function(){var t,n,o,i=u[0],a=d[0],l=!!r.autofocusEnd;if(s.is(":visible")){if(ue.sourceMode())o=f.value.length,f.setSelectionRange?f.setSelectionRange(o,o):f.createTextRange&&(t=f.createTextRange(),t.moveEnd("character",o),t.moveStart("character",o),b.selectRange(t));else{if(e.sceditor.dom.removeWhiteSpace(a),l)for((n=a.lastChild)||d.append(n=i.createElement("div"));n.lastChild;)n=n.lastChild,/br/i.test(n.nodeName)&&n.previousSibling&&(n=n.previousSibling);else n=a.firstChild;i.createRange?(t=i.createRange(),/br/i.test(n.nodeName)?t.setStartBefore(n):t.selectNodeContents(n),t.collapse(!1)):(t=a.createTextRange(),t.moveToElementText(3!==n.nodeType?n:n.parentNode),t.collapse(!1)),b.selectRange(t),l&&(u.scrollTop(a.scrollHeight),d.scrollTop(a.scrollHeight))}ue.focus()}},ue.readOnly=function(e){return"boolean"!=typeof e?"readonly"===p.attr("readonly"):(d[0].contentEditable=!e,e?p.attr("readonly","readonly"):p.removeAttr("readonly"),X(e),this)},ue.rtl=function(e){var t=e?"rtl":"ltr";return"boolean"!=typeof e?"rtl"===p.attr("dir"):(d.attr("dir",t),p.attr("dir",t),s.removeClass("rtl").removeClass("ltr").addClass(t),this)},X=function(t){var n=ue.inSourceMode();a.find(".sceditor-button").removeClass("disabled").each(function(){var o=e(this);!0===t||n&&!o.data("sceditor-txtmode")?o.addClass("disabled"):n||o.data("sceditor-wysiwygmode")||o.addClass("disabled")})},ue.width=function(e,t){return e||0===e?(ue.dimensions(e,null,t),this):s.width()},ue.dimensions=function(t,o,i){var c=8>ce||n.documentMode<8?2:0;return t=!(!t&&0!==t)&&t,o=!(!o&&0!==o)&&o,!1===t&&!1===o?{width:ue.width(),height:ue.height()}:(void 0===l.data("outerWidthOffset")&&ue.updateStyleCache(),!1!==t&&(!1!==i&&(r.width=t),!1===o&&(o=s.height(),i=!1),s.width(t),t&&t.toString().indexOf("%")>-1&&(t=s.width()),l.width(t-l.data("outerWidthOffset")),p.width(t-p.data("outerWidthOffset")),e.sceditor.ios&&d&&d.width(t-l.data("outerWidthOffset")-(d.outerWidth(!0)-d.width()))),!1!==o&&(!1!==i&&(r.height=o),o&&o.toString().indexOf("%")>-1&&(o=s.height(o).height(),s.height("auto")),o-=r.toolbarContainer?0:a.outerHeight(!0),l.height(o-l.data("outerHeightOffset")),p.height(o-c-p.data("outerHeightOffset"))),this)},ue.updateStyleCache=function(){l.data("outerWidthOffset",l.outerWidth(!0)-l.width()),p.data("outerWidthOffset",p.outerWidth(!0)-p.width()),l.data("outerHeightOffset",l.outerHeight(!0)-l.height()),p.data("outerHeightOffset",p.outerHeight(!0)-p.height())},ue.height=function(e,t){return e||0===e?(ue.dimensions(null,e,t),this):s.height()},ue.maximize=function(t){return void 0===t?s.is(".sceditor-maximize"):(t=!!t,7>ce&&e("html, body").toggleClass("sceditor-maximize",t),s.toggleClass("sceditor-maximize",t),ue.width(t?"100%":r.width,!1),ue.height(t?"100%":r.height,!1),this)},ue.expandToContent=function(e){var t=s.height(),n=d[0].scrollHeight||u[0].documentElement.scrollHeight,o=t-l.height(),i=r.resizeMaxHeight||2*(r.height||fe.height());n+=o,!0!==e&&n>i&&(n=i),n>t&&ue.height(n)},ue.destroy=function(){y&&(y.destroy(),b=null,m=null,y=null,e(n).unbind("click",Y),e(t).unbind("resize orientationChanged",K),e(pe.form).unbind("reset",Q).unbind("submit",ue.updateOriginal),d.unbind(),u.unbind().find("*").remove(),p.unbind().remove(),a.remove(),s.unbind().find("*").unbind().remove(),s.remove(),fe.removeData("sceditor").removeData("sceditorbbcode").show(),S&&fe.attr("required","required"))},ue.createDropDown=function(t,n,o,i){var s,a=h&&h.is(".sceditor-"+n);ue.closeDropDown(),a||(!1!==i&&e(o).find(":not(input,textarea)").filter(function(){return 1===this.nodeType}).attr("unselectable","on"),s={top:t.offset().top,left:t.offset().left,marginTop:t.outerHeight()},e.extend(s,r.dropDownCss),h=e('<div class="sceditor-dropdown sceditor-'+n+'" />').css(s).append(o).appendTo(e("body")).on("click focusin",function(e){e.stopPropagation()}))},Y=function(e){3!==e.which&&ue.closeDropDown()},W=function(e){var t,o,i,s=d[0],a=u[0],l=0,c=n.createElement("div"),p=a.createDocumentFragment();if(r.disablePasting)return!1;if(r.enablePasteFiltering){if(b.saveRange(),n.body.appendChild(c),e&&e.clipboardData&&e.clipboardData.getData&&((t=e.clipboardData.getData("text/html"))||(t=e.clipboardData.getData("text/plain"))))return c.innerHTML=t,F(s,c),!1;for(i=d.scrollTop()||u.scrollTop();s.firstChild;)p.appendChild(s.firstChild);return o=function(e,t){if(e.childNodes.length>0||l>25){for(;e.firstChild;)t.appendChild(e.firstChild);for(;p.firstChild;)e.appendChild(p.firstChild);d.scrollTop(i),u.scrollTop(i),t.childNodes.length>0?F(e,t):b.restoreRange()}else l++,setTimeout(function(){o(e,t)},20)},o(s,c),ue.focus(),!0}},F=function(t,n){e.sceditor.dom.fixNesting(n);var o=n.innerHTML;y.hasHandler("toSource")&&(o=y.callOnlyFirst("toSource",o,e(n))),n.parentNode.removeChild(n),y.hasHandler("toWysiwyg")&&(o=y.callOnlyFirst("toWysiwyg",o,!0)),b.restoreRange(),ue.wysiwygEditorInsertHtml(o,null,!0)},ue.closeDropDown=function(e){h&&(h.unbind().remove(),h=null),!0===e&&ue.focus()},_=function(){return c.contentDocument?c.contentDocument:c.contentWindow&&c.contentWindow.document?c.contentWindow.document:c.document?c.document:null},ue.wysiwygEditorInsertHtml=function(t,n,o){var i,r,s,a=l.height();ue.focus(),(o||!e(w).is("code")&&0===e(w).parents("code").length)&&(b.insertHTML(t,n),b.saveRange(),B(d[0]),i=d.find("#sceditor-end-marker").show(),r=d.scrollTop()||u.scrollTop(),s=e.sceditor.dom.getOffset(i[0]).top+1.5*i.outerHeight(!0)-a,i.hide(),(s>r||r>s+a)&&(d.scrollTop(s),u.scrollTop(s)),se(!1),b.restoreRange(),Z())},ue.wysiwygEditorInsertText=function(t,n){ue.wysiwygEditorInsertHtml(e.sceditor.escapeEntities(t),e.sceditor.escapeEntities(n))},ue.insertText=function(e,t){return ue.inSourceMode()?ue.sourceEditorInsertText(e,t):ue.wysiwygEditorInsertText(e,t),this},ue.sourceEditorInsertText=function(e,t){var o,i,r,s;s=f.scrollTop,f.focus(),"undefined"!=typeof f.selectionStart?(i=f.selectionStart,r=f.selectionEnd,e.length,t&&(e+=f.value.substring(i,r)+t),f.value=f.value.substring(0,i)+e+f.value.substring(r,f.value.length),f.selectionStart=i+e.length-(t?t.length:0),f.selectionEnd=f.selectionStart):"undefined"!=typeof n.selection.createRange?(o=n.selection.createRange(),t&&(e+=o.text+t),o.text=e,t&&o.moveEnd("character",0-t.length),o.moveStart("character",o.End-o.Start),o.select()):f.value+=e+t,f.scrollTop=s,f.focus(),se()},ue.getRangeHelper=function(){return b},ue.sourceEditorCaret=function(e){var t={};return"undefined"!=typeof f.selectionStart?e?(f.selectionStart=e.start,f.selectionEnd=e.end):(t.start=f.selectionStart,t.end=f.selectionEnd):(range=n.selection.createRange(),e?(range.moveStart("character",e.start),range.moveEnd("character",e.end),range.select()):(t.start=range.Start,t.end=range.End)),e?this:t},ue.val=function(e,t){return"string"==typeof e?(ue.inSourceMode()?ue.setSourceEditorValue(e):(!1!==t&&y.hasHandler("toWysiwyg")&&(e=y.callOnlyFirst("toWysiwyg",e)),ue.setWysiwygEditorValue(e)),this):ue.inSourceMode()?ue.getSourceEditorValue(!1):ue.getWysiwygEditorValue()},ue.insert=function(t,n,o,i,r){if(ue.inSourceMode())ue.sourceEditorInsertText(t,n);else{if(n){var s=ue.getRangeHelper().selectedHtml(),a=e("<div>").appendTo(e("body")).hide().html(s);!1!==o&&y.hasHandler("toSource")&&(s=y.callOnlyFirst("toSource",s,a)),a.remove(),t+=s+n}!1!==o&&y.hasHandler("toWysiwyg")&&(t=y.callOnlyFirst("toWysiwyg",t,!0)),!1!==o&&!0===r&&(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),ue.wysiwygEditorInsertHtml(t)}return this},ue.getWysiwygEditorValue=function(t){var n,o,i=b.hasSelection();return i?b.saveRange():m&&m.getBookmark&&(o=m.getBookmark()),e.sceditor.dom.fixNesting(d[0]),n=d.html(),!1!==t&&y.hasHandler("toSource")&&(n=y.callOnlyFirst("toSource",n,d)),i?(b.restoreRange(),m=null):o&&(m.moveToBookmark(o),m=null),n},ue.getBody=function(){return d},ue.getContentAreaContainer=function(){return l},ue.getSourceEditorValue=function(e){var t=p.val();return!1!==e&&y.hasHandler("toWysiwyg")&&(t=y.callOnlyFirst("toWysiwyg",t)),t},ue.setWysiwygEditorValue=function(e){e||(e="<p>"+(ce?"":"<br />")+"</p>"),d[0].innerHTML=e,B(d[0]),Z(),se()},ue.setSourceEditorValue=function(e){p.val(e),se()},ue.updateOriginal=function(){fe.val(ue.val())},B=function(t){if(r.emoticonsEnabled&&!e(t).parents("code").length){var n=t.ownerDocument,o=[],s=[],a=e.extend({},r.emoticons.more,r.emoticons.dropdown,r.emoticons.hidden);e.each(a,function(t){r.emoticonsCompat&&(s[t]=new RegExp("(>|^|\\s|\xa0|\u2002|\u2003|\u2009|&nbsp;)"+e.sceditor.regexEscape(t)+"(\\s|$|<|\xa0|\u2002|\u2003|\u2009|&nbsp;)")),o.push(t)}),function t(l){for(l=l.firstChild;null!=l;){var c,d,u,p,f,h,m,g=l.parentNode,b=l.nodeValue;if(3!==l.nodeType)e(l).is("code")||t(l);else if(b)for(f=o.length;f--;)d=o[f],(m=r.emoticonsCompat?b.search(s[d]):b.indexOf(d))>-1&&(h=l.nextSibling,u=a[d],c=b.substr(m).split(d),b=b.substr(0,m)+c.shift(),l.nodeValue=b,p=e.sceditor.dom.parseHTML(i("emoticon",{key:d,url:u.url||u,tooltip:u.tooltip||d}),n),g.insertBefore(p[0],h),g.insertBefore(n.createTextNode(c.join(d)),h));l=l.nextSibling}}(t),r.emoticonsCompat&&(ye=d.find("img[data-sceditor-emoticon]"))}},ue.inSourceMode=function(){return s.hasClass("sourceMode")},ue.sourceMode=function(e){return"boolean"!=typeof e?ue.inSourceMode():((ue.inSourceMode()&&!e||!ue.inSourceMode()&&e)&&ue.toggleSourceMode(),this)},ue.toggleSourceMode=function(){(e.sceditor.isWysiwygSupported||!ue.inSourceMode())&&(ue.blur(),ue.inSourceMode()?ue.setWysiwygEditorValue(ue.getSourceEditorValue()):ue.setSourceEditorValue(ue.getWysiwygEditorValue()),m=null,p.toggle(),l.toggle(),ue.inSourceMode()?s.removeClass("sourceMode").addClass("wysiwygMode"):s.removeClass("wysiwygMode").addClass("sourceMode"),X(),G())},J=function(){return f.focus(),null!=f.selectionStart?f.value.substring(f.selectionStart,f.selectionEnd):n.selection.createRange?n.selection.createRange().text:void 0},D=function(t,n){return ue.inSourceMode()?void(n.txtExec&&(e.isArray(n.txtExec)?ue.sourceEditorInsertText.apply(ue,n.txtExec):n.txtExec.call(ue,t,J()))):void(n.exec&&(e.isFunction(n.exec)?n.exec.call(ue,t):ue.execCommand(n.exec,n.hasOwnProperty("execParam")?n.execParam:null)))},M=function(){ce&&(m=b.selectedRange())},ue.execCommand=function(t,n){var o=!1,i=e(b.parentNode());if(ue.focus(),!i.is("code")&&0===i.parents("code").length){try{o=u[0].execCommand(t,!1,n)}catch(e){}!o&&ue.commands[t]&&ue.commands[t].errorMessage&&alert(ue._(ue.commands[t].errorMessage))}},ee=function(){var t=function(){b&&!b.compare(C)&&(C=b.cloneSelected(),s.trigger(e.Event("selectionchanged"))),k=!1};k||(k=!0,ce?t():setTimeout(t,100))},te=function(){var t,n=b.parentNode();x!==n&&(t=x,x=n,w=b.getFirstBlockParent(n),s.trigger(e.Event("nodechanged",{oldNode:t,newNode:x})))},ue.currentNode=function(){return x},ue.currentBlockNode=function(){return w},G=function(e){var t,n,o,i,r,s=u[0],l=be.length,c=ue.sourceMode();if(ue.sourceMode()||ue.readOnly())a.find(".sceditor-button").removeClass("active");else for(r=e?e.newNode:b.parentNode(),o=b.getFirstBlockParent(r);l--;)if(t=0,n=be[l],i=a.find(".sceditor-button-"+n.name),c&&!i.data("sceditor-txtmode"))i.addClass("disabled");else if(c||i.data("sceditor-wysiwygmode")){if("string"==typeof n.state)try{(t=s.queryCommandEnabled(n.state)?0:-1)>-1&&(t=s.queryCommandState(n.state)?1:0)}catch(e){}else t=n.state.call(ue,r,o);0>t?i.addClass("disabled"):i.removeClass("disabled"),t>0?i.addClass("active"):i.removeClass("active")}else i.addClass("disabled")},V=function(t){var n,o;if(!t.originalEvent.defaultPrevented){if(ue.closeDropDown(),n=e(x),13===t.which&&(n.is("code,blockquote,pre")||0!==n.parents("code,blockquote,pre").length))return m=null,ue.wysiwygEditorInsertHtml("<br />",null,!0),!1;if(!n.is("code")&&0===n.parents("code").length)for(o=he.length;o--;)he[o].call(ue,t,c,p)}},Z=function(){var t,n,o;e.sceditor.dom.rTraverse(d[0],function(i){return t=i.nodeName.toLowerCase(),e.inArray(t,ge)>-1&&(n=!0),3===i.nodeType&&!/^\s*$/.test(i.nodeValue)||"br"===t||de&&!i.firstChild&&!e.sceditor.dom.isInline(i,!1)?(n&&(o=d[0].ownerDocument.createElement("div"),o.className="sceditor-nlf",o.innerHTML=de?"":"<br />",d[0].appendChild(o)),!1):void 0})},Q=function(){ue.val(fe.val())},$=function(){ue.closeDropDown(),m=null},K=function(){var e=r.height,t=r.width;ue.maximize()?ue.dimensions("100%","100%",!1):(e&&e.toString().indexOf("%")>-1||t&&t.toString().indexOf("%")>-1)&&ue.dimensions(t,e)},ue._=function(){var e,t=arguments;return g&&g[t[0]]&&(t[0]=g[t[0]]),t[0].replace(/\{(\d+)\}/g,function(n,o){return t[o-0+1]!==e?t[o-0+1]:"{"+o+"}"})},U=function(t){var n,o=e.extend({},t);y.call(o.type+"Event",t,ue),delete o.type,n=e.Event((t.target===f?"scesrc":"scewys")+t.type,o),s.trigger(n,ue),n.isDefaultPrevented()&&t.preventDefault(),n.isImmediatePropagationStopped()&&n.stopImmediatePropagation(),n.isPropagationStopped()&&n.stopPropagation()},ue.bind=function(t,n,o,i){t=t.split(" ");for(var r=t.length;r--;)e.isFunction(n)&&(o||s.bind("scewys"+t[r],n),i||s.bind("scesrc"+t[r],n),"valuechanged"===t[r]&&(se.hasHandler=!0));return this},ue.unbind=function(t,n,o,i){t=t.split(" ");for(var r=t.length;r--;)e.isFunction(n)&&(o||s.unbind("scewys"+t[r],n),i||s.unbind("scesrc"+t[r],n));return this},ue.blur=function(t,n,o){return e.isFunction(t)?ue.bind("blur",t,n,o):ue.sourceMode()?p.blur():(v||(v=e('<input style="position:absolute;width:0;height:0;opacity:0;border:0;padding:0;filter:alpha(opacity=0)" type="text" />').appendTo(s)),v.removeAttr("disabled").show().focus().blur().hide().attr("disabled","disabled")),this},ue.focus=function(t,n,o){return e.isFunction(t)?ue.bind("focus",t,n,o):ue.inSourceMode()?f.focus():(c.contentWindow.focus(),d[0].focus(),m&&(b.selectRange(m),m=null)),this},ue.keyDown=function(e,t,n){return ue.bind("keydown",e,t,n)},ue.keyPress=function(e,t,n){return ue.bind("keypress",e,t,n)},ue.keyUp=function(e,t,n){return ue.bind("keyup",e,t,n)},ue.nodeChanged=function(e){return ue.bind("nodechanged",e,!1,!0)},ue.selectionChanged=function(e){return ue.bind("selectionchanged",e,!1,!0)},ue.valueChanged=function(e,t,n){return ue.bind("valuechanged",e,t,n)},oe=function(t){var n=0,o=String.fromCharCode(t.which);if(!e(w).is("code")&&!e(w).parents("code").length)return ue.emoticonsCache||(ue.emoticonsCache=[],e.each(e.extend({},r.emoticons.more,r.emoticons.dropdown,r.emoticons.hidden),function(e,t){ue.emoticonsCache[n++]=[e,i("emoticon",{key:e,url:t.url||t,tooltip:t.tooltip||e})]}),ue.emoticonsCache.sort(function(e,t){return e[0].length-t[0].length}),ue.longestEmoticonCode=ue.emoticonsCache[ue.emoticonsCache.length-1][0].length),ue.getRangeHelper().raplaceKeyword(ue.emoticonsCache,!0,!0,ue.longestEmoticonCode,r.emoticonsCompat,o)?(r.emoticonsCompat&&(ye=d.find("img[data-sceditor-emoticon]")),/^\s$/.test(o)&&r.emoticonsCompat):void 0},ie=function(){if(ye.length){var t,n,o,i,r,s,a=ue.currentBlockNode(),l=!1,c=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/;ye=e.map(ye,function(d){return d&&d.parentNode?e.contains(a,d)?(t=d.previousSibling,n=d.nextSibling,r=t.nodeValue,null===r&&(r=t.innerText||""),t&&c.test(t.nodeValue.slice(-1))||n&&c.test((n.nodeValue||"")[0])?(o=d.parentNode,i=b.cloneSelected(),s=i.startContainer,r+=e(d).data("sceditor-emoticon"),s===n?l=r.length+i.startOffset:s===a&&a.childNodes[i.startOffset]===n?l=r.length:s===t&&(l=i.startOffset),n&&3===n.nodeType||(n=o.insertBefore(o.ownerDocument.createTextNode(""),n)),n.insertData(0,r),o.removeChild(t),o.removeChild(d),!1!==l&&(i.setStart(n,l),i.collapse(!0),b.selectRange(i)),null):d):d:null})}},ue.emoticons=function(t){return t||!1===t?(r.emoticonsEnabled=t,t?(d.keypress(oe),ue.sourceMode()||(b.saveRange(),B(d[0]),ye=d.find("img[data-sceditor-emoticon]"),se(!1),b.restoreRange())):(d.find("img[data-sceditor-emoticon]").replaceWith(function(){return e(this).data("sceditor-emoticon")}),ye=[],d.unbind("keypress",oe),se()),this):r.emoticonsEnabled},ue.css=function(t){return E||(E=e('<style id="#inline" />').appendTo(u.find("head"))[0]),"string"!=typeof t?E.styleSheet?E.styleSheet.cssText:E.innerHTML:(E.styleSheet?E.styleSheet.cssText=t:E.innerHTML=t,this)},q=function(e){var t=[],n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},o={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},r=e.which,s=o[r]||String.fromCharCode(r).toLowerCase();return e.ctrlKey&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&(t.push("shift"),i[r]?s=i[r]:n[s]&&(s=n[s])),s&&(16>r||r>18)&&t.push(s),t=t.join("+"),ve[t]?ve[t].call(ue):void 0},ue.addShortcut=function(e,t){return e=e.toLowerCase(),ve[e]="string"==typeof t?function(){return D(a.find(".sceditor-button-"+t),ue.commands[t]),!1}:t,this},ue.removeShortcut=function(e){return delete ve[e.toLowerCase()],this},j=function(n){var o,i,s,a,l;if(!ce&&!r.disableBlockRemove&&8===n.which&&(a=b.selectedRange())&&(t.getSelection?(o=a.startContainer,i=a.startOffset):(o=a.parentElement(),s=u[0].selection.createRange(),s.moveToElementText(o),s.setEndPoint("EndToStart",a),i=s.text.length),0===i&&(l=re()))){for(;o!==l;){for(;o.previousSibling;)if(o=o.previousSibling,3!==o.nodeType||o.nodeValue)return;if(!(o=o.parentNode))return}if(l&&!e(l).is("body"))return ue.clearBlockFormatting(l),!1}},re=function(){for(var t=w;!e.sceditor.dom.hasStyling(t);)if(!(t=t.parentNode)||e(t).is("body"))return;return t},ue.clearBlockFormatting=function(t){return t=t||re(),!t||e(t).is("body")?this:(b.saveRange(),m=null,t.className="",e(t).attr("style",""),e(t).is("p,div")||e.sceditor.dom.convertElement(t,"p"),b.restoreRange(),this)},se=function(t){if(y.hasHandler("valuechangedEvent")||se.hasHandler){var n,o=ue.sourceMode(),i=!o&&b.hasSelection();t=!1!==t&&!u[0].getElementById("sceditor-start-marker"),le.timer&&(clearTimeout(le.timer),le.timer=!1),i&&t&&b.saveRange(),n=d.html(),n!==se.lastHtmlValue&&(se.lastHtmlValue=n,s.trigger(e.Event("valuechanged",{rawValue:o?ue.val():n}))),i&&t&&b.removeMarkers()}},ae=function(){le.timer&&se()},le=function(e){var t=e.which,n=le.lastChar,o=13===n||32===n,i=8===n||46===n;le.lastChar=t,13===t||32===t?o?le.triggerNextChar=!0:se():8===t||46===t?i?le.triggerNextChar=!0:se():le.triggerNextChar&&(se(),le.triggerNextChar=!1),le.timer&&clearTimeout(le.timer),le.timer=setTimeout(function(){se()},1500)},T()},e.sceditor.ie=function(){var e,o=3,i=n.createElement("div"),r=i.getElementsByTagName("i");do{i.innerHTML="<!--[if gt IE "+ ++o+"]><i></i><![endif]-->"}while(r[0]);return n.documentMode&&n.all&&t.atob&&(o=10),4===o&&n.documentMode&&(o=11),o>4?o:e}(),e.sceditor.ios=/iPhone|iPod|iPad| wosbrowser\//i.test(navigator.userAgent),e.sceditor.isWysiwygSupported=function(){var t,n,o=e('<div contenteditable="true">')[0].contentEditable,i=void 0!==o&&"inherit"!==o,r=navigator.userAgent;return!!i&&(n=/Opera Mobi|Opera Mini/i.test(r),/Android/i.test(r)&&(n=!0,/Safari/.test(r)&&(t=/Safari\/(\d+)/.exec(r),n=!t||!t[1]||t[1]<534)),/ Silk\//i.test(r)&&(t=/AppleWebKit\/(\d+)/.exec(r),n=!t||!t[1]||t[1]<534),e.sceditor.ios&&(n=!/OS [5-9](_\d)+ like Mac OS X/i.test(r)),/fennec/i.test(r)&&(n=!1),/OneBrowser/i.test(r)&&(n=!1),"UCWEB"===navigator.vendor&&(n=!1),!n)}(),e.sceditor.regexEscape=function(e){return e.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},e.sceditor.escapeEntities=function(e,t){return e?(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ {2}/g," &nbsp;").replace(/\r\n|\r/g,"\n").replace(/\n/g,"<br />"),t&&(e=e.replace(/"/g,"&#34;").replace(/'/g,"&#39;")),e):e},e.sceditor.escapeUriScheme=function(e){var n,o=/^(?:https?|s?ftp|mailto|spotify|skype|ssh|teamspeak|tel):|(?:\/\/)/i,i=/^[^\/]*:/i,r=t.location;return e&&i.test(e)&&!o.test(e)?(n=r.pathname.split("/"),n.pop(),r.protocol+"://"+r.host+n.join("/")+"/"+e):e},e.sceditor.locale={},e.sceditor.commands={bold:{exec:"bold",tooltip:"Bold",shortcut:"ctrl+b"},italic:{exec:"italic",tooltip:"Italic",shortcut:"ctrl+i"},underline:{exec:"underline",tooltip:"Underline",shortcut:"ctrl+u"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(t,n,o){for(var r=t.opts.fonts.split(","),s=e("<div />"),a=function(){return o(e(this).data("font")),t.closeDropDown(!0),!1},l=0;l<r.length;l++)s.append(i("fontOpt",{font:r[l]},!0).click(a));t.createDropDown(n,"font-picker",s)},exec:function(t){var n=this;e.sceditor.command.get("font")._dropDown(n,t,function(e){n.execCommand("fontname",e)})},tooltip:"Font Name"},size:{_dropDown:function(t,n,o){for(var r=e("<div />"),s=function(n){o(e(this).data("size")),t.closeDropDown(!0),n.preventDefault()},a=1;7>=a;a++)r.append(i("sizeOpt",{size:a},!0).click(s));t.createDropDown(n,"fontsize-picker",r)},exec:function(t){var n=this;e.sceditor.command.get("size")._dropDown(n,t,function(e){n.execCommand("fontsize",e)})},tooltip:"Font Size"},color:{_dropDown:function(t,n,o){var i,r,s,a,l={r:255,g:255,b:255},c=e("<div />"),d=t.opts.colors?t.opts.colors.split("|"):new Array(21),u=[],p=e.sceditor.command.get("color");if(!p._htmlCache){for(i=0;i<d.length;++i){for(a=d[i]?d[i].split(","):new Array(21),u.push('<div class="sceditor-color-column">'),r=0;r<a.length;++r)s=a[r]||"#"+l.r.toString(16)+l.g.toString(16)+l.b.toString(16),u.push('<a href="#" class="sceditor-color-option" style="background-color: '+s+'" data-color="'+s+'"></a>'),r%5==0?(l.g-=51,l.b=255):l.b-=51;u.push("</div>"),i%5==0?(l.r-=51,l.g=255,l.b=255):(l.g=255,l.b=255)}p._htmlCache=u.join("")}c.append(p._htmlCache).find("a").click(function(n){o(e(this).attr("data-color")),t.closeDropDown(!0),n.preventDefault()}),t.createDropDown(n,"color-picker",c)},exec:function(t){var n=this;e.sceditor.command.get("color")._dropDown(n,t,function(e){n.execCommand("forecolor",e)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(e){var t,n=this,o=i("pastetext",{label:n._("Paste your text inside the following box:"),insert:n._("Insert")},!0);o.find(".button").click(function(e){t=o.find("#txt").val(),t&&n.wysiwygEditorInsertText(t),n.closeDropDown(!0),e.preventDefault()}),n.createDropDown(e,"pastetext",o)},tooltip:"Paste Text"},bulletlist:{exec:"insertunorderedlist",tooltip:"Bullet list"},orderedlist:{exec:"insertorderedlist",tooltip:"Numbered list"},indent:{state:function(n,o){var i,r,s,a=e(o),l=a.parents("ul,ol,menu"),c=l.first();if(l.length>1||c.children().length>1)return 0;if(a.is("ul,ol,menu")){if(i=this.getRangeHelper().selectedRange(),!(t.Range&&i instanceof Range))return a.is("li,ul,ol,menu")?0:-1;if(r=i.startContainer.parentNode,s=i.endContainer.parentNode,r!==r.parentNode.firstElementChild||e(s).is("li")&&s!==s.parentNode.lastElementChild)return 0}return-1},exec:function(){var t=this,n=e(t.getRangeHelper().getFirstBlockParent());t.focus(),n.parents("ul,ol,menu")&&t.execCommand("indent")},tooltip:"Add indent"},outdent:{state:function(t,n){return e(n).is("ul,ol,menu")||e(n).parents("ul,ol,menu").length>0?0:-1},exec:function(){var t=this;e(t.getRangeHelper().getFirstBlockParent()).parents("ul,ol,menu")&&t.execCommand("outdent")},tooltip:"Remove one indent"},table:{exec:function(t){var n=this,o=i("table",{rows:n._("Rows:"),cols:n._("Cols:"),insert:n._("Insert")},!0);o.find(".button").click(function(t){var i=e.sceditor.ie,r=o.find("#rows").val()-0,s=o.find("#cols").val()-0,a="<table>";if(!(1>r||1>s)){for(var l=0;r>l;l++){a+="<tr>";for(var c=0;s>c;c++)a+="<td>"+(i&&11>i?"":"<br />")+"</td>";a+="</tr>"}a+="</table>",n.wysiwygEditorInsertHtml(a),n.closeDropDown(!0),t.preventDefault()}}),n.createDropDown(t,"inserttable",o)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{forceNewLineAfter:["code"],exec:function(){this.wysiwygEditorInsertHtml("<code>","<br /></code>")},tooltip:"Code"},image:{exec:function(e){var t=this,n=i("image",{
url:t._("URL:"),width:t._("Width (optional):"),height:t._("Height (optional):"),insert:t._("Insert")},!0);n.find(".button").click(function(e){var o=n.find("#image").val(),i=n.find("#width").val(),r=n.find("#height").val(),s="";i&&(s+=' width="'+i+'"'),r&&(s+=' height="'+r+'"'),o&&"http://"!==o&&t.wysiwygEditorInsertHtml("<img"+s+' src="'+o+'" />'),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"insertimage",n)},tooltip:"Insert an image"},email:{exec:function(e){var t=this,n=i("email",{label:t._("E-mail:"),insert:t._("Insert")},!0);n.find(".button").click(function(e){var o=n.find("#email").val();o&&(t.focus(),t.getRangeHelper().selectedHtml()?t.execCommand("createlink","mailto:"+o):t.wysiwygEditorInsertHtml('<a href="mailto:'+o+'">'+o+"</a>")),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"insertemail",n)},tooltip:"Insert an email"},link:{exec:function(e){var t=this,n=i("link",{url:t._("URL:"),desc:t._("Description (optional):"),ins:t._("Insert")},!0);n.find(".button").click(function(e){var o=n.find("#link").val(),i=n.find("#des").val();o&&"http://"!==o&&(t.focus(),!t.getRangeHelper().selectedHtml()||i?(i||(i=o),t.wysiwygEditorInsertHtml('<a href="'+o+'">'+i+"</a>")):t.execCommand("createlink",o)),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"insertlink",n)},tooltip:"Insert a link"},unlink:{state:function(){var t=e(this.currentNode());return t.is("a")||t.parents("a").length>0?0:-1},exec:function(){var t=e(this.currentNode()),n=t.is("a")?t:t.parents("a").first();n.length&&n.replaceWith(n.contents())},tooltip:"Unlink"},quote:{forceNewLineAfter:["blockquote"],exec:function(t,n,o){var i=e.sceditor.ie,r="<blockquote>",s="</blockquote>";n?(o=o?"<cite>"+o+"</cite>":"",r=r+o+n+s,s=null):""===this.getRangeHelper().selectedHtml()&&(s=i&&11>i?"":"<br />"+s),this.wysiwygEditorInsertHtml(r,s)},tooltip:"Insert a Quote"},emoticon:{exec:function(t){var n=this,o=function(i){var r=n.opts.emoticonsCompat,s=n.getRangeHelper(),a=r&&" "!==s.getOuterText(!0,1)?" ":"",l=r&&" "!==s.getOuterText(!1,1)?" ":"",c=e("<div />"),d=e("<div />").appendTo(c),u=e.extend({},n.opts.emoticons.dropdown,i?n.opts.emoticons.more:{}),p=0;return e.each(u,function(){p++}),p=Math.sqrt(p),e.each(u,function(t,o){d.append(e("<img />").attr({src:o.url||o,alt:t,title:o.tooltip||t}).click(function(){return n.insert(a+e(this).attr("alt")+l,null,!1).closeDropDown(!0),!1})),d.children().length>=p&&(d=e("<div />").appendTo(c))}),i||c.append(e(n._('<a class="sceditor-more">{0}</a>',n._("More"))).click(function(){return n.createDropDown(t,"more-emoticons",o(!0)),!1})),c};n.createDropDown(t,"emoticons",o(!1))},txtExec:function(t){e.sceditor.command.get("emoticon").exec.call(this,t)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(e,t,n){var o,r=i("youtubeMenu",{label:e._("Video URL:"),insert:e._("Insert")},!0);r.find(".button").click(function(t){var i=r.find("#link").val().replace("http://","");""!==i&&(o=i.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),o&&(i=o[1]),/^[a-zA-Z0-9_\-]{11}$/.test(i)?n(i):alert("Invalid YouTube video")),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertlink",r)},exec:function(t){var n=this;e.sceditor.command.get("youtube")._dropDown(n,t,function(e){n.wysiwygEditorInsertHtml(i("youtube",{id:e}))})},tooltip:"Insert a YouTube video"},date:{_date:function(e){var t=new Date,n=t.getYear(),o=t.getMonth()+1,i=t.getDate();return 2e3>n&&(n=1900+n),10>o&&(o="0"+o),10>i&&(i="0"+i),e.opts.dateFormat.replace(/year/i,n).replace(/month/i,o).replace(/day/i,i)},exec:function(){this.insertText(e.sceditor.command.get("date")._date(this))},txtExec:function(){this.insertText(e.sceditor.command.get("date")._date(this))},tooltip:"Insert current date"},time:{_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds();return 10>t&&(t="0"+t),10>n&&(n="0"+n),10>o&&(o="0"+o),t+":"+n+":"+o},exec:function(){this.insertText(e.sceditor.command.get("time")._time())},txtExec:function(){this.insertText(e.sceditor.command.get("time")._time())},tooltip:"Insert current time"},ltr:{state:function(e,t){return t&&"ltr"===t.style.direction},exec:function(){var t=this,n=t.getRangeHelper().getFirstBlockParent(),o=e(n);t.focus(),(n&&!o.is("body")||(t.execCommand("formatBlock","p"),n=t.getRangeHelper().getFirstBlockParent(),o=e(n),n&&!o.is("body")))&&("ltr"===o.css("direction")?o.css("direction",""):o.css("direction","ltr"))},tooltip:"Left-to-Right"},rtl:{state:function(e,t){return t&&"rtl"===t.style.direction},exec:function(){var t=this,n=t.getRangeHelper().getFirstBlockParent(),o=e(n);t.focus(),(n&&!o.is("body")||(t.execCommand("formatBlock","p"),n=t.getRangeHelper().getFirstBlockParent(),o=e(n),n&&!o.is("body")))&&("rtl"===o.css("direction")?o.css("direction",""):o.css("direction","rtl"))},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximize",shortcut:"ctrl+shift+m"},source:{exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"View source",shortcut:"ctrl+shift+s"},ignore:{}},e.sceditor.rangeHelper=function(t,n){var o,i,r,s=n||t.contentDocument||t.document,a=t,l=!!t.getSelection,c="sceditor-start-marker",d="sceditor-end-marker",u="character",p=this;p.insertHTML=function(e,t){var n,o,i=p.selectedRange();if(l){for(t&&(e+=p.selectedHtml()+t),o=s.createElement("div"),n=s.createDocumentFragment(),o.innerHTML=e;o.firstChild;)n.appendChild(o.firstChild);p.insertNode(n)}else{if(!i)return!1;i.pasteHTML(r(e,t,!0))}},r=function(t,n,i){var r,a,l,u=s.createElement("div");if("string"==typeof t?(n&&(t+=p.selectedHtml()+n),u.innerHTML=t):(u.appendChild(t),n&&(u.appendChild(range.extractContents()),u.appendChild(n))),r=u.lastChild){if(p.removeMarkers(),a=e(r),e.sceditor.dom.canHaveChildren(r)?(r.lastChild||a.append(s.createTextNode("\u200b")),a.append(o(d)).append(o(c))):a.after(o(c)).after(o(d)),i)return u.innerHTML;for(l=s.createDocumentFragment();u.firstChild;)l.appendChild(u.firstChild);return l}},p.insertNode=function(e,t){if(l){var n=r(e,t),o=p.selectedRange(),i=o.commonAncestorContainer;if(!n)return!1;o.deleteContents(),i&&/^(br|hr)$/i.test(i.nodeName)?i.parentNode.insertBefore(n,i):o.insertNode(n),p.restoreRange()}else p.insertHTML(e.outerHTML,t?t.outerHTML:null)},p.cloneSelected=function(){var e=p.selectedRange();return e?l?e.cloneRange():e.duplicate():void 0},p.selectedRange=function(){var e,t,n=l?a.getSelection():s.selection;if(n){if(n.getRangeAt&&n.rangeCount<=0){for(t=s.body;t.firstChild;)t=t.firstChild;e=s.createRange(),e.setStart(t,0),n.addRange(e)}return l&&(e=n.getRangeAt(0)),l||"Control"===n.type||(e=n.createRange()),i(e)?e:null}},i=function(e){var t;return!(e&&e.parentElement&&(t=e.parentElement()))||t.ownerDocument===s},p.hasSelection=function(){var e,t=l?a.getSelection():s.selection;return l||!t?t&&t.rangeCount>0:(e=t.createRange())&&i(e)},p.selectedHtml=function(){var e,t=p.selectedRange();return t?!l&&""!==t.text&&t.htmlText?t.htmlText:l?(e=s.createElement("div"),e.appendChild(t.cloneContents()),e.innerHTML):"":""},p.parentNode=function(){var e=p.selectedRange();return e?e.parentElement?e.parentElement():e.commonAncestorContainer:void 0},p.getFirstBlockParent=function(t){var n=function(t){return e.sceditor.dom.isInline(t,!0)?(t=t?t.parentNode:null,t?n(t):null):t};return n(t||p.parentNode())},p.insertNodeAt=function(e,t){var n=p.selectedRange(),o=p.cloneSelected();return!!o&&(o.collapse(e),o.insertNode?o.insertNode(t):o.pasteHTML(t.outerHTML),void p.selectRange(n))},o=function(e){p.removeMarker(e);var t=s.createElement("span");return t.id=e,t.style.lineHeight="0",t.style.display="none",t.className="sceditor-selection sceditor-ignore",t.innerHTML=" ",t},p.insertMarkers=function(){p.insertNodeAt(!0,o(c)),p.insertNodeAt(!1,o(d))},p.getMarker=function(e){return s.getElementById(e)},p.removeMarker=function(e){var t=p.getMarker(e);t&&t.parentNode.removeChild(t)},p.removeMarkers=function(){p.removeMarker(c),p.removeMarker(d)},p.saveRange=function(){p.insertMarkers()},p.selectRange=function(e){l?(a.getSelection().removeAllRanges(),a.getSelection().addRange(e)):e.select()},p.restoreRange=function(){var e,t=p.selectedRange(),n=p.getMarker(c),o=p.getMarker(d);return!!(n&&o&&t)&&(l?(t=s.createRange(),t.setStartBefore(n),t.setEndAfter(o)):(t=s.body.createTextRange(),e=s.body.createTextRange(),e.moveToElementText(n),t.setEndPoint("StartToStart",e),t.moveStart(u,0),e.moveToElementText(o),t.setEndPoint("EndToStart",e),t.moveEnd(u,0)),p.selectRange(t),void p.removeMarkers())},p.selectOuterText=function(e,t){var n=p.cloneSelected();return!!n&&(n.collapse(!1),l?(n.setStart(n.startContainer,n.startOffset-e),n.setEnd(n.endContainer,n.endOffset+t)):(n.moveStart(u,0-e),n.moveEnd(u,t)),void p.selectRange(n))},p.getOuterText=function(e,t){var n="",o=p.cloneSelected();return o?(o.collapse(!1),e?l?(n=o.startContainer.textContent.substr(0,o.startOffset),n=n.substr(Math.max(0,n.length-t))):(o.moveStart(u,0-t),n=o.text):l?n=o.startContainer.textContent.substr(o.startOffset,t):(o.moveEnd(u,t),n=o.text),n):""},p.raplaceKeyword=function(t,n,o,i,r,s){o||t.sort(function(e,t){return e.length-t.length});var a,c,d,u,f,h,m,g=t.length,b=i||t[g-1][0].length;if(r){if(!l)return!1;++b}for(a=p.getOuterText(!0,b),c=a+(null!=s?s:""),n&&(c+=p.getOuterText(!1,b));g--;)if(m=t[g][0],f=new RegExp("(?:[\\s\xa0\u2002\u2003\u2009])"+e.sceditor.regexEscape(m)+"(?=[\\s\xa0\u2002\u2003\u2009])"),h=a.length-1-m.length,r&&--h,h=Math.max(0,h),(d=r?c.substr(h).search(f):c.indexOf(m,h))>-1){if(r&&(d+=h+1),d>a.length||d+m.length+(r?1:0)<a.length)continue;return u=a.length-d,p.selectOuterText(u,m.length-u-(null!=s&&/^\S/.test(s)?1:0)),p.insertHTML(t[g][1]),!0}return!1},p.compare=function(e,t){return t||(t=p.selectedRange()),e&&t?l?0===e.compareBoundaryPoints(Range.END_TO_END,t)&&0===e.compareBoundaryPoints(Range.START_TO_START,t):i(e)&&i(t)&&0===e.compareEndPoints("EndToEnd",t)&&0===e.compareEndPoints("StartToStart",t):!e&&!t}},e.sceditor.dom={traverse:function(e,t,n,o,i){if(e)for(e=i?e.lastChild:e.firstChild;null!=e;){var r=i?e.previousSibling:e.nextSibling;if(!n&&!1===t(e))return!1;if(!o&&!1===this.traverse(e,t,n,o,i))return!1;if(n&&!1===t(e))return!1;e=r}},rTraverse:function(e,t,n,o){this.traverse(e,t,n,o,!0)},parseHTML:function(t,o){var i=[],r=(o||n).createElement("div");return r.innerHTML=t,e.merge(i,r.childNodes),i},hasStyling:function(t){var n=e(t);return t&&(!n.is("p,div")||t.className||n.attr("style")||!e.isEmptyObject(n.data()))},convertElement:function(t,n){for(var o,i,r=t.attributes.length,s=t.ownerDocument.createElement(n);r--;)i=t.attributes[r],(!e.sceditor.ie||i.specified)&&(e.sceditor.ie<8&&/style/i.test(i.name)?t.style.cssText=t.style.cssText:s.setAttribute(i.name,i.value));for(;o=t.firstChild;)s.appendChild(o);return t.parentNode.replaceChild(s,t),s},blockLevelList:"|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",canHaveChildren:function(e){return!!/11?|9/.test(e.nodeType)&&"hr,br,img,input,meta,link,iframe,".indexOf(e.nodeName.toLowerCase()+",")<0},isInline:function(t,n){return!t||1!==t.nodeType||(t=t.tagName.toLowerCase(),"code"===t?!n:e.sceditor.dom.blockLevelList.indexOf("|"+t+"|")<0)},copyCSS:function(e,t){t.style.cssText=e.style.cssText+t.style.cssText},fixNesting:function(e){var t=this,n=function(e){for(;t.isInline(e.parentNode,!0);)e=e.parentNode;return e};t.traverse(e,function(e){if(1===e.nodeType&&!t.isInline(e,!0)&&t.isInline(e.parentNode,!0)){var o=n(e),i=o.parentNode,r=t.extractContents(o,e),s=e;t.copyCSS(o,s),i.insertBefore(r,o),i.insertBefore(s,o)}})},findCommonAncestor:function(t,n){return e(t).parents().has(e(n)).first()},getSibling:function(t,n){var o;return t?(o=t[n?"previousSibling":"nextSibling"])?o:e.sceditor.dom.getSibling(t.parentNode,n):null},removeWhiteSpace:function(t,n){for(var o,i,r,s,a,l,c,d,u=e.sceditor.dom.getSibling,p=e.sceditor.dom.isInline,f=t.firstChild,h=/[\t ]+/g,m=/[\t\n\r ]+/g;f;){if(l=f.nextSibling,o=f.nodeValue,i=f.nodeType,1===i&&f.firstChild&&(a=e(f).css("whiteSpace"),/pre(?:\-wrap)?$/i.test(a)||e.sceditor.dom.removeWhiteSpace(f,/line$/i.test(a))),3===i&&o){for(r=u(f),s=u(f,!0),d=s,c=!1;e(d).hasClass("sceditor-ignore");)d=u(d,!0);if(p(f)&&d){for(;d.lastChild;)d=d.lastChild;c=3===d.nodeType?/[\t\n\r ]$/.test(d.nodeValue):!p(d)}p(f)&&s&&p(s)&&!c||(o=o.replace(/^[\t\n\r ]+/,"")),p(f)&&r&&p(r)||(o=o.replace(/[\t\n\r ]+$/,"")),o=o.replace(/\u200B/g,""),o.length?f.nodeValue=o.replace(n?h:m," "):t.removeChild(f)}f=l}},extractContents:function(e,t){var n=this,o=n.findCommonAncestor(e,t),i=o?o[0]:null,r=!1,s=!1;return function o(i){var a=e.ownerDocument.createDocumentFragment();return n.traverse(i,function(n){if(s||n===t&&r)return s=!0,!1;n===e&&(r=!0);var i,l;r?jQuery.contains(n,t)&&1===n.nodeType?(i=o(n),l=n.cloneNode(!1),l.appendChild(i),a.appendChild(l)):a.appendChild(n):jQuery.contains(n,e)&&1===n.nodeType&&(i=o(n),l=n.cloneNode(!1),l.appendChild(i),a.appendChild(l))},!1),a}(i)},getOffset:function(e){for(var t=0,n=0;e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}},getStyle:function(t,n){var o,i,r,s,a=t.style;if(!a)return null;if(e.sceditor.dom._propertyCache||(e.sceditor.dom._propertyCache={}),r=e.sceditor.dom._propertyCache,r[n]||(r[n]=e.camelCase(n)),n=r[n],s=a[n],"textAlign"===n){if(o=e(t),i=a.direction,s=s||o.css(n),o.parent().css(n)===s||"block"!==o.css("display")||o.is("hr")||o.is("th"))return null;if(i&&s&&(/right/i.test(s)&&"rtl"===i||/left/i.test(s)&&"ltr"===i))return null}return s},hasStyle:function(t,n,o){var i=e.sceditor.dom.getStyle(t,n);return!i&&(!o||i===o||e.isArray(o)&&e.inArray(i,o)>-1)}},e.sceditor.plugins={},e.sceditor.PluginManager=function(t){var n=this,o=[],i=t,r=function(e){return"signal"+e.charAt(0).toUpperCase()+e.slice(1)},s=function(e,t){e=[].slice.call(e);for(var n=o.length,s=r(e.shift());n--;)if(s in o[n]){if(t)return o[n][s].apply(i,e);o[n][s].apply(i,e)}};n.call=function(){s(arguments,!1)},n.callOnlyFirst=function(){return s(arguments,!0)},n.iter=function(e){return e=r(e),function(){var t=o.length;return{callNext:function(n){for(;t--;)if(o[t]&&e in o[t])return o[t].apply(i,n)},hasNext:function(){for(var n=t;n--;)if(o[n]&&e in o[n])return!0;return!1}}}()},n.hasHandler=function(e){var t=o.length;for(e=r(e);t--;)if(e in o[t])return!0;return!1},n.exists=function(t){return t in e.sceditor.plugins&&("function"==typeof(t=e.sceditor.plugins[t])&&"object"==typeof t.prototype)},n.isRegistered=function(t){var i=o.length;if(!n.exists(t))return!1;for(;i--;)if(o[i]instanceof e.sceditor.plugins[t])return!0;return!1},n.register=function(t){return!!n.exists(t)&&(t=new e.sceditor.plugins[t],o.push(t),"init"in t&&t.init.apply(i),!0)},n.deregister=function(t){var r,s=o.length,a=!1;if(!n.isRegistered(t))return!1;for(;s--;)o[s]instanceof e.sceditor.plugins[t]&&(r=o.splice(s,1)[0],a=!0,"destroy"in r&&r.destroy.apply(i));return a},n.destroy=function(){for(var e=o.length;e--;)"destroy"in o[e]&&o[e].destroy.apply(i);o=null,i=null}},e.sceditor.command={get:function(t){return e.sceditor.commands[t]||null},set:function(t,n){return!(!t||!n)&&(n=e.extend(e.sceditor.commands[t]||{},n),n.remove=function(){e.sceditor.command.remove(t)},e.sceditor.commands[t]=n,this)},remove:function(t){return e.sceditor.commands[t]&&delete e.sceditor.commands[t],this}},e.sceditor.defaultOptions={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist,indent,outdent|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,maximize,source",toolbarExclude:null,style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:null,locale:e("html").attr("lang")||"en",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,getHtmlHandler:null,getTextHandler:null,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,id:null,plugins:"",zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},dropDownCss:{}},e.fn.sceditor=function(t){var n,o=[];return t=t||{},t.runWithoutWysiwygSupport||e.sceditor.isWysiwygSupported?(this.each(function(){n=this.jquery?this:e(this),n.parents(".sceditor-container").length>0||("state"===t?o.push(!!n.data("sceditor")):"instance"===t?o.push(n.data("sceditor")):n.data("sceditor")||new e.sceditor(this,t))}),o.length?1===o.length?o[0]:e(o):this):void 0}}(jQuery,window,document),function(e,t,n){"use strict";var o=e.sceditor.escapeEntities,i=e.sceditor.escapeUriScheme,r=e.sceditor.ie,s=r&&11>r;e.sceditor.BBCodeParser=function(t){if(!(this instanceof e.sceditor.BBCodeParser))return new e.sceditor.BBCodeParser(t);var i,a,l,c,d,u,p,f,h,m,g,b,v,y,x,w=this,C={open:"open",content:"content",newline:"newline",close:"close"},k=function(e,t,n,o,i,r){var s=this;s.type=e,s.name=t,s.val=n,s.attrs=o||{},s.children=i||[],s.closing=r||null};k.prototype={clone:function(e){var t=this;return new k(t.type,t.name,t.val,t.attrs,e?t.children:[],t.closing?t.closing.clone():null)},splitAt:function(t){var n,o=this,i=0,r=o.children.length;if("number"!=typeof t&&(t=e.inArray(t,o.children)),0>t||t>r)return null;for(;r--;)r>=t?i++:r=0;return n=o.clone(),n.children=o.children.splice(t,i),n}},i=function(){w.opts=e.extend({},e.sceditor.BBCodeParser.defaults,t),w.bbcodes=e.sceditor.plugins.bbcode.bbcodes},w.tokenize=function(e){var t,n,o,i=[],r=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];r.reverse();e:for(;e.length;){for(o=r.length;o--;)if(n=r[o].type,(t=e.match(r[o].regex))&&t[0]){i.push(a(n,t[0])),e=e.substr(t[0].length);continue e}e.length&&i.push(a(C.content,e)),e=""}return i},a=function(t,n){var o,i,r;return"open"===t&&(o=n.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/))?(r=y(o[1]),o[2]&&(o[2]=e.trim(o[2]))&&(i=l(o[2]))):"close"===t&&(o=n.match(/\[\/([^\[\]]+)\]/))?r=y(o[1]):"newline"===t&&(r="#newline"),r&&("open"!==t&&"close"!==t||e.sceditor.plugins.bbcode.bbcodes[r])||(t="content",r="#"),new k(t,r,n,i)},l=function(t){var n,o=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,i=e.sceditor.plugins.bbcode.stripQuotes,r={};if("="===t.charAt(0)&&t.indexOf("=",1)<0)r.defaultattr=i(t.substr(1));else for("="===t.charAt(0)&&(t="defaultattr"+t);n=o.exec(t);)r[y(n[1])]=i(n[3])||n[4];return r},w.parse=function(e,t){var n=c(w.tokenize(e));return w.opts.fixInvalidChildren&&h(n),w.opts.removeEmptyTags&&f(n),w.opts.fixInvalidNesting&&u(n),d(n,null,t),w.opts.removeEmptyTags&&f(n),n},b=function(e,t,n){for(var o=n.length;o--;)if(n[o].type===t&&n[o].name===e)return!0;return!1},p=function(t,n){var o=t?w.bbcodes[t.name]:null,i=o?o.allowedChildren:null;return!(w.opts.fixInvalidChildren&&i&&i&&e.inArray(n.name||"#",i)<0)},c=function(t){for(var n,o,i,r,s,a,l=[],c=[],d=[],u=function(){return x(d)},p=function(e){u()?u().children.push(e):c.push(e)},f=function(t){return u()&&(o=w.bbcodes[u().name])&&o.closedBy&&e.inArray(t,o.closedBy)>-1};n=t.shift();){switch(a=t[0],n.type){case C.open:f(n.name)&&d.pop(),p(n),o=w.bbcodes[n.name],o&&o.isSelfClosing||!o.closedBy&&!b(n.name,C.close,t)?o&&o.isSelfClosing||(n.type=C.content):d.push(n);break;case C.close:if(u()&&n.name!==u().name&&f("/"+n.name)&&d.pop(),u()&&n.name===u().name)u().closing=n,d.pop();else if(b(n.name,C.open,d)){for(;i=d.pop();){if(i.name===n.name){i.closing=n;break}r=i.clone(),l.length>1&&r.children.push(x(l)),l.push(r)}for(p(x(l)),s=l.length;s--;)d.push(l[s]);l.length=0}else n.type=C.content,p(n);break;case C.newline:u()&&a&&f((a.type===C.close?"/":"")+a.name)&&(a.type!==C.close||a.name!==u().name)&&(o=w.bbcodes[u().name],o&&o.breakAfter?d.pop():o&&!1===o.isInline&&w.opts.breakAfterBlock&&!1!==o.breakAfter&&d.pop()),p(n);break;default:p(n)}n}return c},d=function(e,t,n){var o,i,r,s,a,l,c,u,p=e.length,f=p;for(t&&(s=w.bbcodes[t.name]);f--;)if(o=e[f])if(o.type===C.newline){if(i=f>0?e[f-1]:null,r=p-1>f?e[f+1]:null,u=!1,!n&&s&&!0!==s.isSelfClosing&&(i?l||r||(!1===s.isInline&&w.opts.breakEndBlock&&!1!==s.breakEnd&&(u=!0),s.breakEnd&&(u=!0),l=u):(!1===s.isInline&&w.opts.breakStartBlock&&!1!==s.breakStart&&(u=!0),s.breakStart&&(u=!0))),i&&i.type===C.open&&(a=w.bbcodes[i.name])&&(n?!1===a.isInline&&(u=!0):(!1===a.isInline&&w.opts.breakAfterBlock&&!1!==a.breakAfter&&(u=!0),a.breakAfter&&(u=!0))),!n&&!c&&r&&r.type===C.open&&(a=w.bbcodes[r.name])&&(!1===a.isInline&&w.opts.breakBeforeBlock&&!1!==a.breakBefore&&(u=!0),a.breakBefore&&(u=!0),c=u,u)){e.splice(f,1);continue}u&&e.splice(f,1),c=!1}else o.type===C.open&&d(o.children,o,n)},u=function(t,n,o,i){var r,s,a,l,c,d,p=function(e){var t=w.bbcodes[e.name];return!t||!1!==t.isInline};for(n=n||[],i=i||t,s=0;s<t.length;s++)if((r=t[s])&&r.type===C.open){if(!p(r)&&o&&(a=x(n),d=a.splitAt(r),c=n.length>1?n[n.length-2].children:i,(l=e.inArray(a,c))>-1))return d.children.splice(e.inArray(r,d.children),1),void c.splice(l+1,0,r,d);n.push(r),u(r.children,n,o||p(r),i),n.pop(r)}},h=function(e,t){for(var n,o,i=e.length;i--;)(n=e[i])&&(p(t,n)||(n.name=null,n.type=C.content,p(t,n)?(o=[i+1,0].concat(n.children),n.closing&&(n.closing.name=null,n.closing.type=C.content,o.push(n.closing)),i+=o.length-1,Array.prototype.splice.apply(e,o)):t.children.splice(i,1)),n.type===C.open&&h(n.children,n))},f=function(t){var n,o,i,r=t.length;for(i=function(e){for(var t=e.length;t--;){if(e[t].type===C.open)return!1;if(e[t].type===C.close)return!1;if(e[t].type===C.content&&e[t].val&&/\S|\u00A0/.test(e[t].val))return!1}return!0};r--;)(n=t[r])&&n.type===C.open&&(o=w.bbcodes[n.name],f(n.children),i(n.children)&&o&&!o.isSelfClosing&&!o.allowsEmpty&&t.splice.apply(t,e.merge([r,1],n.children)))},w.toHTML=function(e,t){return m(w.parse(e,t),!0)},m=function(t,i){var a,l,c,d,u,p,f,h,g=[];for(f=function(e){return!1!==(!e||("undefined"!=typeof e.isHtmlInline?e.isHtmlInline:e.isInline))};t.length>0;)if(a=t.shift()){if(a.type===C.open)h=a.children[a.children.length-1]||{},l=w.bbcodes[a.name],u=i&&f(l),c=m(a.children,!1),l&&l.html?(f(l)||!f(w.bbcodes[h.name])||l.isPreFormatted||l.skipLastLineBreak||s||(c+="<br />"),e.isFunction(l.html)?d=l.html.call(w,a,a.attrs,c):(a.attrs[0]=c,d=e.sceditor.plugins.bbcode.formatBBCodeString(l.html,a.attrs))):d=a.val+c+(a.closing?a.closing.val:"");else{if(a.type===C.newline){if(!i){g.push("<br />");continue}p||(g.push("<div>"),(n.documentMode&&n.documentMode<8||8>r)&&g.push("\xa0")),s||g.push("<br />"),t.length||g.push("<br />"),g.push("</div>\n"),p=!1;continue}u=i,d=o(a.val,!0)}u&&!p?(g.push("<div>"),p=!0):!u&&p&&(g.push("</div>\n"),p=!1),g.push(d)}return p&&g.push("</div>\n"),g.join("")},w.toBBCode=function(e,t){return g(w.parse(e,t))},g=function(t){for(var n,o,i,r,s,a,l,c,d,u,p=[];t.length>0;)if(n=t.shift())if(i=w.bbcodes[n.name],r=!(!i||!1!==i.isInline),s=i&&i.isSelfClosing,l=r&&w.opts.breakBeforeBlock&&!1!==i.breakBefore||i&&i.breakBefore,c=r&&!s&&w.opts.breakStartBlock&&!1!==i.breakStart||i&&i.breakStart,d=r&&w.opts.breakEndBlock&&!1!==i.breakEnd||i&&i.breakEnd,u=r&&w.opts.breakAfterBlock&&!1!==i.breakAfter||i&&i.breakAfter,a=(i?i.quoteType:null)||w.opts.quoteType||e.sceditor.BBCodeParser.QuoteType.auto,i||n.type!==C.open)if(n.type===C.open){if(l&&p.push("\n"),p.push("["+n.name),n.attrs){n.attrs.defaultattr&&(p.push("="+v(n.attrs.defaultattr,a,"defaultattr")),delete n.attrs.defaultattr);for(o in n.attrs)n.attrs.hasOwnProperty(o)&&p.push(" "+o+"="+v(n.attrs[o],a,o))}p.push("]"),c&&p.push("\n"),n.children&&p.push(g(n.children)),s||i.excludeClosing||(d&&p.push("\n"),p.push("[/"+n.name+"]")),u&&p.push("\n"),n.closing&&s&&p.push(n.closing.val)}else p.push(n.val);else p.push(n.val),n.children&&p.push(g(n.children)),n.closing&&p.push(n.closing.val);return p.join("")},v=function(t,n,o){var i=e.sceditor.BBCodeParser.QuoteType,r=/\s|=/.test(t);return e.isFunction(n)?n(t,o):n===i.never||n===i.auto&&!r?t:'"'+t.replace("\\","\\\\").replace('"','\\"')+'"'},x=function(e){return e.length?e[e.length-1]:null},y=function(e){return e.toLowerCase()},i()},e.sceditor.BBCodeParser.QuoteType={always:1,never:2,auto:3},e.sceditor.BBCodeParser.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:e.sceditor.BBCodeParser.QuoteType.auto},e.sceditorBBCodePlugin=e.sceditor.plugins.bbcode=function(){var t,o,i,r,a,l,c=this;r=e.sceditor.plugins.bbcode.formatString,c.bbcodes=e.sceditor.plugins.bbcode.bbcodes,c.stripQuotes=e.sceditor.plugins.bbcode.stripQuotes;var d={},u={},p={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};c.init=function(){c.opts=this.opts,t(),a(this),this.toBBCode=c.signalToSource,this.fromBBCode=c.signalToWysiwyg},a=function(t){var n=e.sceditor.command.get,o={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(e){var t=this;n("font")._dropDown(t,e,function(e){t.insertText("[font="+e+"]","[/font]")})}},size:{txtExec:function(e){var t=this;n("size")._dropDown(t,e,function(e){t.insertText("[size="+e+"]","[/size]")})}},color:{txtExec:function(e){var t=this;n("color")._dropDown(t,e,function(e){t.insertText("[color="+e+"]","[/color]")})}},bulletlist:{txtExec:function(n,o){var i="";e.each(o.split(/\r?\n/),function(){i+=(i?"\n":"")+"[li]"+this+"[/li]"}),t.insertText("[ul]\n"+i+"\n[/ul]")}},orderedlist:{txtExec:function(n,o){var i="";e.each(o.split(/\r?\n/),function(){i+=(i?"\n":"")+"[li]"+this+"[/li]"}),e.sceditor.plugins.bbcode.bbcode.get(""),t.insertText("[ol]\n"+i+"\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e,t){var n=prompt(this._("Enter the image URL:"),t);n&&this.insertText("[img]"+n+"[/img]")}},email:{txtExec:function(e,t){var n=t&&t.indexOf("@")>-1?null:t,o=prompt(this._("Enter the e-mail address:"),n?"":t),i=prompt(this._("Enter the displayed text:"),n||o)||o;o&&this.insertText("[email="+o+"]"+i+"[/email]")}},link:{txtExec:function(t,n){var o=/^[a-z]+:\/\//i.test(e.trim(n))?null:n,i=prompt(this._("Enter URL:"),o?"http://":e.trim(n)),r=prompt(this._("Enter the displayed text:"),o||i)||i;i&&this.insertText("[url="+i+"]"+r+"[/url]")}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(e){var t=this;n("youtube")._dropDown(t,e,function(e){t.insertText("[youtube]"+e+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}};t.commands=e.extend(!0,{},o,t.commands)},t=function(){e.each(c.bbcodes,function(t){c.bbcodes[t].tags&&e.each(c.bbcodes[t].tags,function(e,n){var o=!1===c.bbcodes[t].isInline;d[e]=d[e]||{},d[e][o]=d[e][o]||{},d[e][o][t]=n}),c.bbcodes[t].styles&&e.each(c.bbcodes[t].styles,function(e,n){var o=!1===c.bbcodes[t].isInline;u[o]=u[o]||{},u[o][e]=u[o][e]||{},u[o][e][t]=n})})},o=function(t,n,o){var i,s,a=e.sceditor.dom.getStyle;return o=!!o,u[o]?(e.each(u[o],function(o,l){(i=a(t[0],o))&&a(t.parent()[0],o)!==i&&e.each(l,function(o,a){(!a||e.inArray(i.toString(),a)>-1)&&(s=c.bbcodes[o].format,n=e.isFunction(s)?s.call(c,t,n):r(s,n))})}),n):n},i=function(t,n,o){var i,a,l=t[0],u=l.nodeName.toLowerCase();o=!!o,d[u]&&d[u][o]&&e.each(d[u][o],function(o,s){(!s||(i=!1,e.each(s,function(n,o){return!t.attr(n)||o&&e.inArray(t.attr(n),o)<0?void 0:(i=!0,!1)}),i))&&(a=c.bbcodes[o].format,n=e.isFunction(a)?a.call(c,t,n):r(a,n))});var p=e.sceditor.dom.isInline;if(o&&(!p(l,!0)||"br"===u)){for(var f=l.parentNode,h=f.lastChild,m=l.previousSibling,g=p(f,!0);m&&(e(m).hasClass("sceditor-ignore")||1===m.nodeType&&p(m,!0)&&!m.firstChild);)m=m.previousSibling;for(;e(h).hasClass("sceditor-ignore");)h=h.previousSibling;(g||h!==l||"li"===u||"br"===u&&s)&&(n+="\n"),"br"!==u&&m&&"br"!==m.nodeName.toLowerCase()&&p(m,!0)&&(n="\n"+n)}return n},c.signalToSource=function(t,o){var i,r,s=new e.sceditor.BBCodeParser(c.opts.parserOptions);return o||("string"==typeof t?(i=e("<div />").css("visibility","hidden").appendTo(n.body).html(t),o=i):o=e(t)),o&&o.jquery?(e.sceditor.dom.removeWhiteSpace(o[0]),r=c.elementToBbcode(o),i&&i.remove(),r=s.toBBCode(r,!0),c.opts.bbcodeTrim&&(r=e.trim(r)),r):""},c.elementToBbcode=function(t){return function t(n,r){var a="";return e.sceditor.dom.traverse(n,function(n){var l=e(n),c="",d=n.nodeType,u=n.nodeName.toLowerCase(),f=p[u],h=n.firstChild,m=!0;if("object"==typeof r&&(m=e.inArray(u,r)>-1,l.is("img")&&l.data("sceditor-emoticon")&&(m=!0),m||(f=r)),3===d||1===d)if(1===d){if(l.hasClass("sceditor-ignore"))return;if(l.hasClass("sceditor-nlf")&&(!h||!s&&1===n.childNodes.length&&/br/i.test(h.nodeName)))return;"iframe"!==u&&(c=t(n,f)),m?("code"!==u&&(c=o(l,c),c=i(l,c),c=o(l,c,!0)),a+=i(l,c,!0)):a+=c}else!n.wholeText||n.previousSibling&&3===n.previousSibling.nodeType?n.wholeText||(a+=n.nodeValue):a+=0===l.parents("code").length?n.wholeText.replace(/ +/g," "):n.wholeText},!1,!0),a}(t[0])},c.signalToWysiwyg=function(t,n){var o=new e.sceditor.BBCodeParser(c.opts.parserOptions),i=o.toHTML(c.opts.bbcodeTrim?e.trim(t):t);return n?l(i):i},l=function(t){var o,i,r,a=e("<div />").hide().appendTo(n.body),l=a[0];return r=function(t,o){if(!e.sceditor.dom.hasStyling(t)){if(s||1!==t.childNodes.length||!e(t.firstChild).is("br"))for(;i=t.firstChild;)l.insertBefore(i,t);if(o){var r=l.lastChild;t!==r&&e(r).is("div")&&t.nextSibling===r&&l.insertBefore(n.createElement("br"),t)}l.removeChild(t)}},l.innerHTML=t.replace(/<\/div>\n/g,"</div>"),(o=l.firstChild)&&e(o).is("div")&&r(o,!0),(o=l.lastChild)&&e(o).is("div")&&r(o),l=l.innerHTML,a.remove(),l}},e.sceditor.plugins.bbcode.stripQuotes=function(e){return e?e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):e},e.sceditor.plugins.bbcode.formatString=function(){var e,t=arguments;return t[0].replace(/\{(\d+)\}/g,function(n,o){return t[o-0+1]!==e?t[o-0+1]:"{"+o+"}"})},e.sceditor.plugins.bbcode.formatBBCodeString=function(e,t){return e.replace(/\{(!?[^}]+)\}/g,function(e,n){var i,r=!0;return"!"===n[0]&&(r=!1,n=n.substring(1)),"0"===n[0]&&(r=!1),t[n]===i?e:r?o(t[n],!0):t[n]})};var a=e.sceditor.plugins.bbcode.normaliseColour=function(e){var t,n;return n=function(e){return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)).toString(16),e.length<2?"0"+e:e)},e=e||"#000",(t=e.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+n(t[1])+n(t[2]-0)+n(t[3]-0):(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e};e.sceditor.plugins.bbcode.bbcodes={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",
html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n;return"font"===e[0].nodeName.toLowerCase()&&(n=e.attr("face"))||(n=e.css("font-family")),"[font="+this.stripQuotes(n)+"]"+t+"[/font]"},html:'<font face="{defaultattr}">{0}</font>'},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=e.attr("size"),o=2;return n||(n=e.css("fontSize")),n.indexOf("px")>-1?(n=n.replace("px","")-0,12>n&&(o=1),n>15&&(o=3),n>17&&(o=4),n>23&&(o=5),n>31&&(o=6),n>47&&(o=7)):o=n,"[size="+o+"]"+t+"[/size]"},html:'<font size="{defaultattr}">{!0}</font>'},color:{tags:{font:{color:null}},styles:{color:null},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n,o=e[0];return"font"===o.nodeName.toLowerCase()&&(n=e.attr("color"))||(n=o.style.color||e.css("color")),"[color="+a(n)+"]"+t+"[/color]"},html:function(e,t,n){return'<font color="'+o(a(t.defaultattr),!0)+'">'+n+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["/ul","/ol","/list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return e.data("sceditor-emoticon")+t},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:!0,isSelfClosing:!0,isInline:!1,format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},allowedChildren:["#"],quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n,o,i="",r=e[0],s=function(e){return r.style?r.style[e]:null};return e.attr("data-sceditor-emoticon")?t:(n=e.attr("width")||s("width"),o=e.attr("height")||s("height"),(r.complete&&(n||o)||n&&o)&&(i="="+e.width()+"x"+e.height()),"[img"+i+"]"+e.attr("src")+"[/img]")},html:function(e,t,n){var r,s,a,l,c="";return t.width!==r&&(s=t.width),t.height!==r&&(a=t.height),t.defaultattr&&(l=t.defaultattr.split(/x/i),s=l[0],a=2===l.length?l[1]:l[0]),s!==r&&(c+=' width="'+o(s,!0)+'"'),a!==r&&(c+=' height="'+o(a,!0)+'"'),"<img"+c+' src="'+i(n)+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(e,t){var n=e.attr("href");return"mailto:"===n.substr(0,7)?'[email="'+n.substr(7)+'"]'+t+"[/email]":"[url="+n+"]"+t+"[/url]"},html:function(e,t,n){return t.defaultattr=o(t.defaultattr,!0)||n,'<a href="'+i(t.defaultattr)+'">'+n+"</a>"}},email:{quoteType:e.sceditor.BBCodeParser.QuoteType.never,html:function(e,t,n){return'<a href="mailto:'+(o(t.defaultattr,!0)||n)+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:e.sceditor.BBCodeParser.QuoteType.never,format:function(t,n){var o="",i=e(t),r=i.children("cite").first();return(1===r.length||i.data("author"))&&(o=r.text()||i.data("author"),i.data("author",o),r.remove(),n=this.elementToBbcode(e(t)),o="="+o,i.prepend(r)),"[quote"+o+"]"+n+"[/quote]"},html:function(e,t,n){return t.defaultattr&&(n="<cite>"+o(t.defaultattr)+"</cite>"+n),"<blockquote>"+n+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(e,t){return e=e.attr("data-youtube-id"),e?"[youtube]"+e+"[/youtube]":t},html:'<iframe width="560" height="315" src="http://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" frameborder="0" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}},e.sceditor.plugins.bbcode.bbcode={get:function(t){return e.sceditor.plugins.bbcode.bbcodes[t]||null},set:function(t,n){var o=e.sceditor.plugins.bbcode.bbcodes;return!(!t||!n)&&(n=e.extend(o[t]||{},n),n.remove=function(){delete o[t]},o[t]=n,this)},rename:function(t,n){var o=e.sceditor.plugins.bbcode.bbcodes;return t in o&&(o[n]=o[t],delete o[t],this)},remove:function(t){var n=e.sceditor.plugins.bbcode.bbcodes;return t in n&&delete n[t],this}},e.fn.sceditorBBCodePlugin=function(t){return t=t||{},e.isPlainObject(t)&&(t.plugins=(t.plugins?t.plugins:"")+"bbcode"),this.sceditor(t)}}(jQuery,window,document);